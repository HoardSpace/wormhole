!function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){function r(){requestAnimationFrame(r);var e=v.getDelta();.001>e||(E.update(e),l.position.x>m?l.position.x=m:l.position.x<-m&&(l.position.x=-m),n())}function n(){_.render(l)}var a=i(9),o=i(3),s=i(4),c=i(5),h=i(8),d=document.querySelector("#container"),u=new a(1.4,5),l=new o(u),m=4*u.radius+u.throatLength,p=2*u.radius+u.throatLength;l.position.set(p,.5*Math.PI,0),l.rotateY(.5*-Math.PI);var E=new s(l,d),v=new THREE.Clock,_=new c(d,u,m);r(),new h(_)},function(e,t){function i(e,t,i){THREE.Geometry.call(this),this._space=e,this._build(t,i)}function r(e,t){this._scene=new THREE.Scene,this._camera=new THREE.PerspectiveCamera(60,1,1,1e3),this._camera.up.set(0,0,1),this._geometry=new i(e,-t,t),this._dotMesh=new THREE.Mesh(new THREE.SphereGeometry(.1,32,32),new THREE.MeshBasicMaterial),this._scene.add(this._dotMesh);var r=new THREE.TextureLoader,n=r.load("textures/grid.png");n.anisotropy=4,n.wrapS=THREE.MirroredRepeatWrapping,n.wrapT=THREE.MirroredRepeatWrapping;var a=new THREE.ShaderMaterial({uniforms:{map:{type:"t",value:n}},vertexShader:["varying vec2 vCoordinate;","varying float vPixelPos;","void main() {","vCoordinate = uv;","vec4 vertex = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vPixelPos = length(vertex.xy) / vertex.w;","gl_Position = vertex;","}"].join("\n"),fragmentShader:["uniform sampler2D map;","varying vec2 vCoordinate;","varying float vPixelPos;","void main() {","vec2 uv = vec2(","vCoordinate.x * 0.8,","vCoordinate.y * 4.0 * 0.15915494309",");","vec4 color = texture2D(map, uv);","color.rgb *= (1.0 - vPixelPos);","gl_FragColor = color;","}"].join("\n"),side:THREE.DoubleSide,blending:THREE.AdditiveBlending,transparent:!0,depthTest:!1});this._wormholeMesh=new THREE.Mesh(this._geometry,a),this._scene.add(this._wormholeMesh)}i.prototype=Object.create(THREE.Geometry.prototype),i.prototype._build=function(e,t){var i,r,n,a=80,o=32,s=(t-e)/a,c=2*Math.PI/o,h=[],d=[];for(i=0,n=0;o>=n;n++)for(r=0;a>=r;r++){var u=e+r*s,l=t+n*c;h[i]=new THREE.Vector2(u,l);var m=this.getPoint(u,l,m);this.vertices[i]=m;var p=this.getNormal(u,l,p);d[i]=p,i++}for(i=0,n=1;o>=n;n++)for(r=1;a>=r;r++){var E=(a+1)*n+r-1,v=(a+1)*(n-1)+r-1,_=(a+1)*(n-1)+r,g=(a+1)*n+r;this.faces[i]=new THREE.Face3(v,E,g,[d[v].clone(),d[E].clone(),d[g].clone()]),this.faceVertexUvs[0][i]=[h[v].clone(),h[E].clone(),h[g].clone()],i++,this.faces[i]=new THREE.Face3(v,g,_,[d[v].clone(),d[g].clone(),d[_].clone()]),this.faceVertexUvs[0][i]=[h[v].clone(),h[g].clone(),h[_].clone()],i++}this.computeFaceNormals(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this.uvsNeedUpdate=!0},i.prototype.getPoint=function(e,t){var i=Math.abs(e)-this._space.throatLength;if(i>=0){var r=Math.sqrt(i*i+this._space.radiusSquared),n=r/this._space.radius,a=new THREE.Vector3(r*Math.cos(t),r*Math.sin(t),this._space.throatLength+this._space.radius*Math.log(n+Math.sqrt(n*n-1)));return 0>e&&(a.z*=-1),a}return new THREE.Vector3(this._space.radius*Math.cos(t),this._space.radius*Math.sin(t),e)},i.prototype.getNormal=function(e,t){var i=Math.abs(e)-this._space.throatLength;if(i>=0){var r=Math.sqrt(i*i+this._space.radiusSquared),n=new THREE.Vector3(i*Math.cos(t)*(0>e?-1:1),i*Math.sin(t)*(0>e?-1:1),this._space.radius);n.divideScalar(r);var a=new THREE.Vector3(-r*Math.sin(t),r*Math.cos(t),0);return(new THREE.Vector3).crossVectors(a,n).normalize()}return new THREE.Vector3(Math.cos(t),Math.sin(t),0)},r.prototype={setRatio:function(e){this._camera.aspect=e,this._camera.updateProjectionMatrix()},render:function(e,t){var i=this._geometry.getPoint(t.position.x,t.position.z),r=Math.sqrt(i.x*i.x+i.y*i.y);this._camera.position.set(8*i.x/r,8*i.y/r,0),this._camera.lookAt(i),this._dotMesh.position.copy(i),e.render(this._scene,this._camera,null,!1)}},e.exports=r},function(e,t){var i={Matrix3:{subtract:function(e,t){for(var i=0;9>i;i++)e.elements[i]-=t.elements[i];return e},getInverse:function(e,t){var i=t.elements,r=e.elements,n=i[0],a=i[1],o=i[2],s=i[3],c=i[4],h=i[5],d=i[6],u=i[7],l=i[8],m=l*c-h*u,p=-l*s+h*d,E=u*s-c*d,v=n*m+a*p+o*E;if(!v)throw new Error("0 determinant");return v=1/v,r[0]=m*v,r[1]=(-l*a+o*u)*v,r[2]=(h*a-o*c)*v,r[3]=p*v,r[4]=(l*n-o*d)*v,r[5]=(-h*n+o*s)*v,r[6]=E*v,r[7]=(-u*n+a*d)*v,r[8]=(c*n-a*s)*v,e.multiplyScalar(1/v),e}}};e.exports=i},function(e,t){function i(e){THREE.Object3D.apply(this),this.space=e}i.prototype=Object.create(THREE.Object3D.prototype),i.prototype.move=function(e){var t=e.length();e=e.clone().normalize().applyQuaternion(this.quaternion),this.space.move(this,e,t)},e.exports=i},function(e,t){function i(e,t){function i(e){o.mouseSpeedX+=4*(e.movementX||e.mozMovementX||e.webkitMovementX||0)}function r(e){switch(e.keyCode){case 65:o.moveLeft=!0;break;case 68:o.moveRight=!0;break;case 87:o.moveForward=!0;break;case 83:o.moveBackward=!0;break;case 82:o.moveUp=!0;break;case 70:o.moveDown=!0;break;case 81:o.rotateLeft=!0;break;case 69:o.rotateRight=!0}}function n(e){switch(e.keyCode){case 65:o.moveLeft=!1;break;case 68:o.moveRight=!1;break;case 87:o.moveForward=!1;break;case 83:o.moveBackward=!1;break;case 82:o.moveUp=!1;break;case 70:o.moveDown=!1;break;case 81:o.rotateLeft=!1;break;case 69:o.rotateRight=!1}}function a(){document.pointerLockElement===t||document.mozPointerLockElement===t||document.webkitPointerLockElement===t?document.addEventListener("mousemove",i,!1):document.removeEventListener("mousemove",i,!1)}var o=this;this.player=e,this.domElement=t,this.velocity=new THREE.Vector3,this.targetVelocity=new THREE.Vector3,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.rotateLeft=!1,this.rotateRight=!1,this.mouseSpeedX=0,this.mouseSpeedY=0,t.onclick=function(){t.requestPointerLock=t.requestPointerLock||t.mozRequestPointerLock||t.webkitRequestPointerLock,t.requestPointerLock()},document.addEventListener("pointerlockchange",a,!1),document.addEventListener("mozpointerlockchange",a,!1),document.addEventListener("webkitpointerlockchange",a,!1),document.addEventListener("keydown",r,!1),document.addEventListener("keyup",n,!1)}i.prototype={update:function(){var e=new THREE.Vector3(0,0,1),t=new THREE.Quaternion;return function(i){var r=this.player;this.mouseSpeedX-=4*this.mouseSpeedX*i,this.mouseSpeedY-=4*this.mouseSpeedY*i;var n=new THREE.Vector3(this.mouseSpeedX*i,-this.mouseSpeedY*i,100);n.normalize(),t.setFromUnitVectors(e,n),r.quaternion.multiplyQuaternions(r.quaternion,t),this.velocity.set(0,0,0),this.moveForward&&this.velocity.add(new THREE.Vector3(0,0,1)),this.moveBackward&&this.velocity.add(new THREE.Vector3(0,0,-1)),this.moveLeft&&this.velocity.add(new THREE.Vector3(-1,0,0)),this.moveRight&&this.velocity.add(new THREE.Vector3(1,0,0)),this.velocity.lengthSq()>0&&(this.velocity.normalize().multiplyScalar(i),this.player.move(this.velocity))}}()},e.exports=i},function(e,t,i){function r(e,t,i){this._webglRenderer=new THREE.WebGLRenderer,this._webglRenderer.autoClear=!1,this.showDiagram=!0,e.appendChild(this._webglRenderer.domElement),this._container=e,this._space=t,this._sceneRenderer=new n(t,this._getWidth(),this._getHeight()),this._scaledRenderer=new a(this._getWidth(),this._getHeight(),this._getPixelSize()),this._diagramRenderer=new o(t,i),this.resize()}var n=i(7),a=i(6),o=i(1);r.prototype={_getWidth:function(){return this._container.clientWidth},_getHeight:function(){return this._container.clientHeight},_getPixelSize:function(){return parseInt(document.querySelector("[name=resolution]:checked").value)},updatePixelSize:function(){this._scaledRenderer.setPixelSize(this._getPixelSize())},render:function(e){this._webglRenderer.setViewport(0,0,this._getWidth(),this._getHeight()),this._sceneRenderer.render(this._webglRenderer,e,this._scaledRenderer.renderTarget),this._scaledRenderer.render(this._webglRenderer),this.showDiagram&&(this._webglRenderer.setViewport(0,0,this._getWidth()/3,this._getHeight()/3),this._webglRenderer.clearDepth(),this._diagramRenderer.render(this._webglRenderer,e))},resize:function(){var e=this._getWidth(),t=this._getHeight();this._webglRenderer.setSize(e,t),this._sceneRenderer.setSize(e,t),this._scaledRenderer.setSize(e,t),this._diagramRenderer.setRatio(e/t)}},e.exports=r},function(e,t){function i(e,t,i){this._width=e,this._height=t,this._pixelSize=i,this.renderTarget=new THREE.WebGLRenderTarget(Math.floor(e/i),Math.floor(t/i),{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat}),this._camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this._scene=new THREE.Scene;var r=new THREE.BufferGeometry,n=new THREE.BufferAttribute(new Float32Array([-1,-1,-1,1,1,1,-1,-1,1,1,1,-1]),2);r.addAttribute("position",n);var a=new THREE.RawShaderMaterial({uniforms:{tRendered:{type:"t",value:this.renderTarget}},vertexShader:["precision highp float;","attribute vec2 position;","varying vec2 vUv;","void main() {","vUv = position * 0.5 + 0.5;","gl_Position = vec4(position, 0.0, 1.0);","}"].join("\n"),fragmentShader:["precision highp float;","varying vec2 vUv;","uniform sampler2D tRendered;","void main() {","gl_FragColor = texture2D(tRendered, vUv);","}"].join("\n"),side:THREE.DoubleSide}),o=new THREE.Mesh(r,a);this._scene.add(o)}i.prototype={setSize:function(e,t){this._width=e,this._height=t,this.renderTarget.setSize(Math.floor(this._width/this._pixelSize),Math.floor(this._height/this._pixelSize))},setPixelSize:function(e){this._pixelSize=e,this.renderTarget.setSize(Math.floor(this._width/this._pixelSize),Math.floor(this._height/this._pixelSize))},render:function(e){e.render(this._scene,this._camera)}},e.exports=i},function(e,t){function i(e,t,i){function r(e,t){t=t||"jpg";var i=["sky_pos_x","sky_neg_x","sky_pos_y","sky_neg_y","sky_pos_z","sky_neg_z"].map(function(i){return e+i+"."+t}),r=n.load(i);return r.format=THREE.RGBFormat,r}this._aspectFix=new THREE.Matrix4;var n=new THREE.CubeTextureLoader;this._uniforms={uRadiusSquared:{type:"f",value:e.radiusSquared},uThroatLength:{type:"f",value:e.throatLength},uSkybox1:{type:"t",value:r("textures/skybox1/")},uSkybox2:{type:"t",value:r("textures/skybox2/")},uCameraPosition:{type:"v3",value:new THREE.Vector3},uCameraOrientation:{type:"m4",value:new THREE.Matrix4}},this._camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this._scene=new THREE.Scene;var a=new THREE.BufferGeometry,o=new THREE.BufferAttribute(new Float32Array([-1,-1,-1,1,1,1,-1,-1,1,1,1,-1]),2);a.addAttribute("position",o);var s=new THREE.RawShaderMaterial({uniforms:this._uniforms,vertexShader:document.getElementById("vertexShader").textContent,fragmentShader:document.getElementById("fragmentShader").textContent,side:THREE.DoubleSide}),c=new THREE.Mesh(a,s);this._scene.add(c)}i.prototype={render:function(e,t,i){this._uniforms.uCameraPosition.value.copy(t.position),this._uniforms.uCameraOrientation.value.makeRotationFromQuaternion(t.quaternion),this._uniforms.uCameraOrientation.value.multiply(this._aspectFix),e.render(this._scene,this._camera,i)},setSize:function(e,t){this._renderWidth=e,this._renderHeight=t;var i,r;e>t?(i=e/t,r=1):(i=1,r=t/e),this._aspectFix.set(i,0,0,0,0,r,0,0,0,0,2,0,0,0,0,1)}},e.exports=i},function(e,t){function i(e){function t(){e.resize()}function i(t){a.blur(),a.checked?(document.body.classList.add("no-ui"),e.showDiagram=!1):(document.body.classList.remove("no-ui"),e.showDiagram=!0)}function r(e){e.target.href||(document.querySelector("#introduction").classList.add("hidden"),t(),document.removeEventListener("click",r,!1))}function n(t){e.updatePixelSize(),t.target.blur()}var a=document.querySelector("[name=hide-ui]");i(),a.addEventListener("change",i,!1),window.addEventListener("resize",t,!1),document.addEventListener("click",r,!1),document.querySelector(".renderer-settings").addEventListener("change",n,!1)}e.exports=i},function(e,t,i){function r(e,t){this.radius=e,this.radiusSquared=e*e,this.throatLength=t}var n=i(2);r.prototype={adjustCartesianDirection:function(e,t){var i=Math.max(0,Math.abs(e.x)-this.throatLength),r=Math.sqrt(i*i+this.radiusSquared);t.y/=r,t.z/=r*Math.sin(e.y)},adjustSphericalDirection:function(e,t){var i=Math.max(0,Math.abs(e.x)-this.throatLength),r=Math.sqrt(i*i+this.radiusSquared);t.y*=r,t.z*=r*Math.sin(e.y)},step:function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3,r=new THREE.Vector3,a=new THREE.Matrix3,o=new THREE.Matrix3,s=new THREE.Vector3,c=new THREE.Matrix3,h=new THREE.Matrix3,d=new THREE.Matrix3,u=new THREE.Vector3,l=new THREE.Vector3,m=new THREE.Matrix3,p=new THREE.Matrix3;return function(E,v,_){var g=E.position,w=Math.max(0,Math.abs(g.x)-this.throatLength),R=this.radiusSquared,f=g.x/Math.abs(g.x)*w,y=g.y,x=v.x,T=v.y,H=v.z,M=f*f,S=T*T,b=H*H,k=Math.sin(y),L=Math.cos(y),z=Math.sin(2*y),q=Math.cos(2*y),V=k*k,P=L*k,C=1/Math.tan(y),D=1/k,F=R,j=1/(F+f*f),B=j*j;if(r.set(f*(S+V*b),-2*f*x*T*j+P*b,-2*f*x*H*j-2*C*T*H),a.set(0,2*T*f,2*H*f*V,-2*T*f*j,-2*x*f*j,H*z,-2*H*f*j,-2*H*C,-2*x*f*j-2*T*C),o.set(S+b*V,b*f*z,0,2*x*T*(M-F)*B,b*q,0,2*x*H*(M-F)*B,2*T*H*D*D,0),m.identity(),n.Matrix3.subtract(m,a.multiplyScalar(_)),n.Matrix3.subtract(m,o.multiplyScalar(_*_)),n.Matrix3.getInverse(p,m),t.copy(r).addScaledVector(v.clone().applyMatrix3(o),_).multiplyScalar(_),t.applyMatrix3(p),e.copy(v.clone().add(t).multiplyScalar(_)),E.__tetrad)for(var U=0;2>U;U++){var W=E.__tetrad[U],A=W.x,G=W.y,I=W.z;s.set(f*(T*G+V*H*I),-f*(x*G+A*T)*j+P*H*I,-f*(x*I+A*H)*j-C*(T*I+G*H)),c.set(0,f*G,f*I*V,-f*G*j,-f*A*j,I*P,-f*I*j,-I*C,-f*A*j-G*C),h.set(T*G+H*I*V,H*f*I*z,0,(T*A+x*G)*(M-F)*B,H*I*q,0,(H*A+x*I)*(M-F)*B,(H*G+T*I)*D*D,0),d.set(0,T*f,H*f*V,-T*f*j,-x*f*j,H*P,-H*f*j,-H*C,-x*f*j-T*C),m.identity(),n.Matrix3.subtract(m,d.multiplyScalar(_)),n.Matrix3.getInverse(p,m),u.copy(e).applyMatrix3(h),l.copy(t).applyMatrix3(c),i.copy(s).add(u).add(l).multiplyScalar(_).applyMatrix3(p),W.add(i)}v.add(t),g.add(e)}}(),quaternionToTetrad:function(){var e=new THREE.Matrix4;return function(t,i){e.makeRotationFromQuaternion(t),i[0].set(e.elements[0],e.elements[1],e.elements[2]),i[1].set(e.elements[4],e.elements[5],e.elements[6])}}(),tetradToQuaternion:function(){var e=new THREE.Matrix4;return function(t,i){t[2].crossVectors(t[0],t[1]);for(var r=0;3>r;r++)t[r].normalize();e.elements[0]=t[0].x,e.elements[1]=t[0].y,e.elements[2]=t[0].z,e.elements[4]=t[1].x,e.elements[5]=t[1].y,e.elements[6]=t[1].z,e.elements[8]=t[2].x,e.elements[9]=t[2].y,e.elements[10]=t[2].z,i.setFromRotationMatrix(e).normalize()}}(),move:function(e,t,i){this.adjustCartesianDirection(e.position,t),e.quaternion&&(e.__tetrad||(e.__tetrad=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]),this.quaternionToTetrad(e.quaternion,e.__tetrad),this.adjustCartesianDirection(e.position,e.__tetrad[0]),this.adjustCartesianDirection(e.position,e.__tetrad[1])),this.step(e,t,i),this.adjustSphericalDirection(e.position,t),e.quaternion&&(this.adjustSphericalDirection(e.position,e.__tetrad[0]),this.adjustSphericalDirection(e.position,e.__tetrad[1]),this.tetradToQuaternion(e.__tetrad,e.quaternion))}},e.exports=r}]);