!function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){function n(){requestAnimationFrame(n);var e=_.getDelta();if(!(.001>e)){f.update(e);var t=m.throatLength+4*m.radius;E.position.x>t?E.position.x=t:E.position.x<-t&&(E.position.x=-t),r()}}function r(){p.render(E)}function o(){p.resize()}function a(){y.checked?document.body.classList.add("no-ui"):document.body.classList.remove("no-ui")}function s(e){e.target.href||(document.querySelector("#introduction").classList.add("hidden"),o(),document.removeEventListener("click",s,!1))}var c=i(1),h=i(3),d=i(4),u=i(5),l=document.querySelector("#container"),m=new c(1.4,5),p=new u(l,m),E=new h(m),v=2*m.radius+m.throatLength;E.position.set(v,.5*Math.PI,0),E.rotateY(.5*-Math.PI);var f=new d(E,l),_=new THREE.Clock;window.addEventListener("resize",o,!1),n();var y=document.querySelector("[name=hide-ui]");y.addEventListener("change",a,!1),a(),document.addEventListener("click",s,!1)},function(e,t,i){function n(e,t){this.radius=e,this.radiusSquared=e*e,this.throatLength=t}var r=i(2);n.prototype={adjustCartesianDirection:function(e,t){var i=Math.max(0,Math.abs(e.x)-this.throatLength),n=Math.sqrt(i*i+this.radiusSquared);t.y/=n,t.z/=n*Math.sin(e.y)},adjustSphericalDirection:function(e,t){var i=Math.max(0,Math.abs(e.x)-this.throatLength),n=Math.sqrt(i*i+this.radiusSquared);t.y*=n,t.z*=n*Math.sin(e.y)},step:function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Matrix3,a=new THREE.Matrix3,s=new THREE.Vector3,c=new THREE.Matrix3,h=new THREE.Matrix3,d=new THREE.Matrix3,u=new THREE.Vector3,l=new THREE.Vector3,m=new THREE.Matrix3,p=new THREE.Matrix3;return function(E,v,f){var _=E.position,y=Math.max(0,Math.abs(_.x)-this.throatLength),R=this.radiusSquared,w=_.x/Math.abs(_.x)*y,x=_.y,g=v.x,T=v.y,S=v.z,H=w*w,k=T*T,M=S*S,b=Math.sin(x),L=Math.cos(x),z=Math.sin(2*x),q=Math.cos(2*x),V=b*b,F=L*b,C=1/Math.tan(x),P=1/b,D=R,j=1/(D+w*w),B=j*j;if(n.set(w*(k+V*M),-2*w*g*T*j+F*M,-2*w*g*S*j-2*C*T*S),o.set(0,2*T*w,2*S*w*V,-2*T*w*j,-2*g*w*j,S*z,-2*S*w*j,-2*S*C,-2*g*w*j-2*T*C),a.set(k+M*V,M*w*z,0,2*g*T*(H-D)*B,M*q,0,2*g*S*(H-D)*B,2*T*S*P*P,0),m.identity(),r.Matrix3.subtract(m,o.multiplyScalar(f)),r.Matrix3.subtract(m,a.multiplyScalar(f*f)),r.Matrix3.getInverse(p,m),t.copy(n).addScaledVector(v.clone().applyMatrix3(a),f).multiplyScalar(f),t.applyMatrix3(p),e.copy(v.clone().add(t).multiplyScalar(f)),E.__tetrad)for(var I=0;2>I;I++){var O=E.__tetrad[I],U=O.x,W=O.y,X=O.z;s.set(w*(T*W+V*S*X),-w*(g*W+U*T)*j+F*S*X,-w*(g*X+U*S)*j-C*(T*X+W*S)),c.set(0,w*W,w*X*V,-w*W*j,-w*U*j,X*F,-w*X*j,-X*C,-w*U*j-W*C),h.set(T*W+S*X*V,S*w*X*z,0,(T*U+g*W)*(H-D)*B,S*X*q,0,(S*U+g*X)*(H-D)*B,(S*W+T*X)*P*P,0),d.set(0,T*w,S*w*V,-T*w*j,-g*w*j,S*F,-S*w*j,-S*C,-g*w*j-T*C),m.identity(),r.Matrix3.subtract(m,d.multiplyScalar(f)),r.Matrix3.getInverse(p,m),u.copy(e).applyMatrix3(h),l.copy(t).applyMatrix3(c),i.copy(s).add(u).add(l).multiplyScalar(f).applyMatrix3(p),O.add(i)}v.add(t),_.add(e)}}(),quaternionToTetrad:function(){var e=new THREE.Matrix4;return function(t,i){e.makeRotationFromQuaternion(t),i[0].set(e.elements[0],e.elements[1],e.elements[2]),i[1].set(e.elements[4],e.elements[5],e.elements[6])}}(),tetradToQuaternion:function(){var e=new THREE.Matrix4;return function(t,i){t[2].crossVectors(t[0],t[1]);for(var n=0;3>n;n++)t[n].normalize();e.elements[0]=t[0].x,e.elements[1]=t[0].y,e.elements[2]=t[0].z,e.elements[4]=t[1].x,e.elements[5]=t[1].y,e.elements[6]=t[1].z,e.elements[8]=t[2].x,e.elements[9]=t[2].y,e.elements[10]=t[2].z,i.setFromRotationMatrix(e).normalize()}}(),move:function(e,t,i){this.adjustCartesianDirection(e.position,t),e.quaternion&&(e.__tetrad||(e.__tetrad=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]),this.quaternionToTetrad(e.quaternion,e.__tetrad),this.adjustCartesianDirection(e.position,e.__tetrad[0]),this.adjustCartesianDirection(e.position,e.__tetrad[1])),this.step(e,t,i),this.adjustSphericalDirection(e.position,t),e.quaternion&&(this.adjustSphericalDirection(e.position,e.__tetrad[0]),this.adjustSphericalDirection(e.position,e.__tetrad[1]),this.tetradToQuaternion(e.__tetrad,e.quaternion))}},e.exports=n},function(e,t){var i={Matrix3:{subtract:function(e,t){for(var i=0;9>i;i++)e.elements[i]-=t.elements[i];return e},getInverse:function(e,t){var i=t.elements,n=e.elements,r=i[0],o=i[1],a=i[2],s=i[3],c=i[4],h=i[5],d=i[6],u=i[7],l=i[8],m=l*c-h*u,p=-l*s+h*d,E=u*s-c*d,v=r*m+o*p+a*E;if(!v)throw new Error("0 determinant");return v=1/v,n[0]=m*v,n[1]=(-l*o+a*u)*v,n[2]=(h*o-a*c)*v,n[3]=p*v,n[4]=(l*r-a*d)*v,n[5]=(-h*r+a*s)*v,n[6]=E*v,n[7]=(-u*r+o*d)*v,n[8]=(c*r-o*s)*v,e.multiplyScalar(1/v),e}}};e.exports=i},function(e,t){function i(e){THREE.Object3D.apply(this),this.space=e}i.prototype=Object.create(THREE.Object3D.prototype),i.prototype.move=function(e){var t=e.length();e=e.clone().normalize().applyQuaternion(this.quaternion),this.space.move(this,e,t)},e.exports=i},function(e,t){function i(e,t){function i(e){a.mouseSpeedX+=4*(e.movementX||e.mozMovementX||e.webkitMovementX||0)}function n(e){switch(e.keyCode){case 65:a.moveLeft=!0;break;case 68:a.moveRight=!0;break;case 87:a.moveForward=!0;break;case 83:a.moveBackward=!0;break;case 82:a.moveUp=!0;break;case 70:a.moveDown=!0;break;case 81:a.rotateLeft=!0;break;case 69:a.rotateRight=!0}}function r(e){switch(e.keyCode){case 65:a.moveLeft=!1;break;case 68:a.moveRight=!1;break;case 87:a.moveForward=!1;break;case 83:a.moveBackward=!1;break;case 82:a.moveUp=!1;break;case 70:a.moveDown=!1;break;case 81:a.rotateLeft=!1;break;case 69:a.rotateRight=!1}}function o(){document.pointerLockElement===t||document.mozPointerLockElement===t||document.webkitPointerLockElement===t?document.addEventListener("mousemove",i,!1):document.removeEventListener("mousemove",i,!1)}var a=this;this.player=e,this.domElement=t,this.velocity=new THREE.Vector3,this.targetVelocity=new THREE.Vector3,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.rotateLeft=!1,this.rotateRight=!1,this.mouseSpeedX=0,this.mouseSpeedY=0,t.onclick=function(){t.requestPointerLock=t.requestPointerLock||t.mozRequestPointerLock||t.webkitRequestPointerLock,t.requestPointerLock()},document.addEventListener("pointerlockchange",o,!1),document.addEventListener("mozpointerlockchange",o,!1),document.addEventListener("webkitpointerlockchange",o,!1),document.addEventListener("keydown",n,!1),document.addEventListener("keyup",r,!1)}i.prototype={update:function(){var e=new THREE.Vector3(0,0,1),t=new THREE.Quaternion;return function(i){var n=this.player;this.mouseSpeedX-=4*this.mouseSpeedX*i,this.mouseSpeedY-=4*this.mouseSpeedY*i;var r=new THREE.Vector3(this.mouseSpeedX*i,-this.mouseSpeedY*i,100);r.normalize(),t.setFromUnitVectors(e,r),n.quaternion.multiplyQuaternions(n.quaternion,t),this.velocity.set(0,0,0),this.moveForward&&this.velocity.add(new THREE.Vector3(0,0,1)),this.moveBackward&&this.velocity.add(new THREE.Vector3(0,0,-1)),this.moveLeft&&this.velocity.add(new THREE.Vector3(-1,0,0)),this.moveRight&&this.velocity.add(new THREE.Vector3(1,0,0)),this.velocity.lengthSq()>0&&(this.velocity.normalize().multiplyScalar(i),this.player.move(this.velocity))}}()},e.exports=i},function(e,t,i){function n(e,t){this._webglRenderer=new THREE.WebGLRenderer,e.appendChild(this._webglRenderer.domElement),this._container=e,this._space=t,this._sceneRenderer=new r(t,this._getWidth(),this._getHeight()),this._scaledRenderer=new o(this._getWidth(),this._getHeight(),this._getPixelSize()),this.resize(),document.querySelector(".renderer-settings").addEventListener("change",function(e){this._updatePixelSize(),e.target.blur()}.bind(this))}var r=i(6),o=i(7);n.prototype={_getWidth:function(){return this._container.clientWidth},_getHeight:function(){return this._container.clientHeight},_getPixelSize:function(){return parseInt(document.querySelector("[name=resolution]:checked").value)},_updatePixelSize:function(){this._scaledRenderer.setPixelSize(this._getPixelSize())},render:function(e){this._sceneRenderer.render(this._webglRenderer,e,this._scaledRenderer.renderTarget),this._scaledRenderer.render(this._webglRenderer)},resize:function(){var e=this._getWidth(),t=this._getHeight();this._webglRenderer.setSize(e,t),this._sceneRenderer.setSize(e,t),this._scaledRenderer.setSize(e,t)}},e.exports=n},function(e,t){function i(e,t,i){function n(e,t){t=t||"jpg";var i=["sky_pos_x","sky_neg_x","sky_pos_y","sky_neg_y","sky_pos_z","sky_neg_z"].map(function(i){return e+i+"."+t}),n=r.load(i);return n.format=THREE.RGBFormat,n}this._aspectFix=new THREE.Matrix4;var r=new THREE.CubeTextureLoader;this._uniforms={uRadiusSquared:{type:"f",value:e.radiusSquared},uThroatLength:{type:"f",value:e.throatLength},uSkybox1:{type:"t",value:n("textures/skybox1/")},uSkybox2:{type:"t",value:n("textures/skybox2/")},uCameraPosition:{type:"v3",value:new THREE.Vector3},uCameraOrientation:{type:"m4",value:new THREE.Matrix4}},this._camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this._scene=new THREE.Scene;var o=new THREE.BufferGeometry,a=new THREE.BufferAttribute(new Float32Array([-1,-1,-1,1,1,1,-1,-1,1,1,1,-1]),2);o.addAttribute("position",a);var s=new THREE.RawShaderMaterial({uniforms:this._uniforms,vertexShader:document.getElementById("vertexShader").textContent,fragmentShader:document.getElementById("fragmentShader").textContent,side:THREE.DoubleSide}),c=new THREE.Mesh(o,s);this._scene.add(c)}i.prototype={render:function(e,t,i){this._uniforms.uCameraPosition.value.copy(t.position),this._uniforms.uCameraOrientation.value.makeRotationFromQuaternion(t.quaternion),this._uniforms.uCameraOrientation.value.multiply(this._aspectFix),e.render(this._scene,this._camera,i)},setSize:function(e,t){this._renderWidth=e,this._renderHeight=t;var i,n;e>t?(i=e/t,n=1):(i=1,n=t/e),this._aspectFix.set(i,0,0,0,0,n,0,0,0,0,2,0,0,0,0,1)}},e.exports=i},function(e,t){function i(e,t,i){this._width=e,this._height=t,this._pixelSize=i,this.renderTarget=new THREE.WebGLRenderTarget(Math.floor(e/i),Math.floor(t/i),{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat}),this._camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this._scene=new THREE.Scene;var n=new THREE.BufferGeometry,r=new THREE.BufferAttribute(new Float32Array([-1,-1,-1,1,1,1,-1,-1,1,1,1,-1]),2);n.addAttribute("position",r);var o=new THREE.RawShaderMaterial({uniforms:{tRendered:{type:"t",value:this.renderTarget}},vertexShader:["precision highp float;","attribute vec2 position;","varying vec2 vUv;","void main() {","vUv = position * 0.5 + 0.5;","gl_Position = vec4(position, 0.0, 1.0);","}"].join("\n"),fragmentShader:["precision highp float;","varying vec2 vUv;","uniform sampler2D tRendered;","void main() {","gl_FragColor = texture2D(tRendered, vUv);","}"].join("\n"),side:THREE.DoubleSide}),a=new THREE.Mesh(n,o);this._scene.add(a)}i.prototype={setSize:function(e,t){this._width=e,this._height=t,this.renderTarget.setSize(Math.floor(this._width/this._pixelSize),Math.floor(this._height/this._pixelSize))},setPixelSize:function(e){this._pixelSize=e,this.renderTarget.setSize(Math.floor(this._width/this._pixelSize),Math.floor(this._height/this._pixelSize))},render:function(e){e.render(this._scene,this._camera)}},e.exports=i}]);
//# sourceMappingURL=dist.js.map