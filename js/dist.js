!function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){function r(){requestAnimationFrame(r);var e=v.getDelta();.001>e||(E.update(e),l.position.x>m?l.position.x=m:l.position.x<-m&&(l.position.x=-m),n())}function n(){_.render(l)}var o=i(9),a=i(3),s=i(4),h=i(5),c=i(8),d=document.querySelector("#container"),u=new o(1.4,5),l=new a(u),m=4*u.radius+u.throatLength,p=2*u.radius+u.throatLength;l.position.set(p,.5*Math.PI,0),l.rotateY(.5*-Math.PI);var E=new s(l,d),v=new THREE.Clock,_=new h(d,u,m);r(),new c(_)},function(e,t){function i(e,t,i){THREE.Geometry.call(this),this._space=e,this._build(t,i)}function r(e,t){this._scene=new THREE.Scene,this._camera=new THREE.PerspectiveCamera(60,1,1,1e3),this._camera.up.set(0,0,1),this._limit=t,this._geometry=new i(e,-t,t);var r=new THREE.MeshBasicMaterial;this._player=new THREE.Object3D,this._dotMesh=new THREE.Mesh(new THREE.SphereGeometry(.1,32,32),r),this._player.add(this._dotMesh),this._directionMesh=new THREE.Mesh(new THREE.BoxGeometry(.1,.1,.4),r),this._directionMesh.position.z=-.2,this._player.add(this._directionMesh),this._scene.add(this._player);var n=new THREE.TextureLoader,o=n.load("textures/grid.png");o.anisotropy=4,o.wrapS=THREE.MirroredRepeatWrapping,o.wrapT=THREE.MirroredRepeatWrapping;var a=new THREE.ShaderMaterial({uniforms:{map:{type:"t",value:o}},vertexShader:["varying vec2 vCoordinate;","varying float vPixelPos;","void main() {","vCoordinate = uv;","vec4 vertex = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vPixelPos = length(vertex.xy) / vertex.w;","gl_Position = vertex;","}"].join("\n"),fragmentShader:["uniform sampler2D map;","varying vec2 vCoordinate;","varying float vPixelPos;","void main() {","vec2 uv = vec2(","vCoordinate.x * 0.8,","vCoordinate.y * 4.0 * 0.15915494309",");","vec4 color = texture2D(map, uv);","color.rgb *= (1.0 - vPixelPos);","gl_FragColor = color;","}"].join("\n"),side:THREE.DoubleSide,blending:THREE.AdditiveBlending,transparent:!0,depthTest:!1});this._wormholeMesh=new THREE.Mesh(this._geometry,a),this._scene.add(this._wormholeMesh)}i.prototype=Object.create(THREE.Geometry.prototype),i.prototype._build=function(e,t){var i,r,n,o=80,a=32,s=(t-e)/o,h=2*Math.PI/a,c=[],d=[];for(i=0,n=0;a>=n;n++)for(r=0;o>=r;r++){var u=e+r*s,l=t+n*h;c[i]=new THREE.Vector2(u,l);var m=this.getPoint(u,l,m);this.vertices[i]=m;var p=this.getNormal(u,l,p);d[i]=p,i++}for(i=0,n=1;a>=n;n++)for(r=1;o>=r;r++){var E=(o+1)*n+r-1,v=(o+1)*(n-1)+r-1,_=(o+1)*(n-1)+r,g=(o+1)*n+r;this.faces[i]=new THREE.Face3(v,E,g,[d[v].clone(),d[E].clone(),d[g].clone()]),this.faceVertexUvs[0][i]=[c[v].clone(),c[E].clone(),c[g].clone()],i++,this.faces[i]=new THREE.Face3(v,g,_,[d[v].clone(),d[g].clone(),d[_].clone()]),this.faceVertexUvs[0][i]=[c[v].clone(),c[g].clone(),c[_].clone()],i++}this.computeFaceNormals(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this.uvsNeedUpdate=!0},i.prototype.getPoint=function(e,t){var i=Math.abs(e)-this._space.throatLength;if(i>=0){var r=Math.sqrt(i*i+this._space.radiusSquared),n=r/this._space.radius,o=new THREE.Vector3(r*Math.cos(t),r*Math.sin(t),this._space.throatLength+this._space.radius*Math.log(n+Math.sqrt(n*n-1)));return 0>e&&(o.z*=-1),o}return new THREE.Vector3(this._space.radius*Math.cos(t),this._space.radius*Math.sin(t),e)},i.prototype.getXTangent=function(e,t){var i=Math.max(Math.abs(e)-this._space.throatLength,0),r=new THREE.Vector3(i*Math.cos(t)*(0>e?-1:1),i*Math.sin(t)*(0>e?-1:1),this._space.radius);return r.normalize()},i.prototype.getNormal=function(e,t){var i=Math.abs(e)-this._space.throatLength;if(i>=0){var r=Math.sqrt(i*i+this._space.radiusSquared),n=new THREE.Vector3(i*Math.cos(t)*(0>e?-1:1),i*Math.sin(t)*(0>e?-1:1),this._space.radius);n.divideScalar(r);var o=new THREE.Vector3(-r*Math.sin(t),r*Math.cos(t),0);return(new THREE.Vector3).crossVectors(o,n).normalize()}return new THREE.Vector3(Math.cos(t),Math.sin(t),0)},r.prototype={setRatio:function(e){this._camera.aspect=e,this._camera.updateProjectionMatrix()},render:function(e,t){var i=this._geometry.getPoint(t.position.x,t.position.z),r=Math.sqrt(i.x*i.x+i.y*i.y),n=this._limit+1;this._camera.position.set(i.x/r*n,i.y/r*n,0),this._camera.lookAt(i),this._player.position.copy(i);var o=this._geometry.getNormal(t.position.x,t.position.z),a=this._geometry.getXTangent(t.position.x,t.position.z),s=(new THREE.Vector3).crossVectors(o,a),h=new THREE.Matrix4;h.elements[0]=o.x,h.elements[1]=o.y,h.elements[2]=o.z,h.elements[4]=a.x,h.elements[5]=a.y,h.elements[6]=a.z,h.elements[8]=s.x,h.elements[9]=s.y,h.elements[10]=s.z,this._player.quaternion.setFromRotationMatrix(h),this._player.rotateY(t.rotation.x),this._player.rotateX(t.rotation.y),e.render(this._scene,this._camera,null,!1)}},e.exports=r},function(e,t){var i={Matrix3:{subtract:function(e,t){for(var i=0;9>i;i++)e.elements[i]-=t.elements[i];return e},getInverse:function(e,t){var i=t.elements,r=e.elements,n=i[0],o=i[1],a=i[2],s=i[3],h=i[4],c=i[5],d=i[6],u=i[7],l=i[8],m=l*h-c*u,p=-l*s+c*d,E=u*s-h*d,v=n*m+o*p+a*E;if(!v)throw new Error("0 determinant");return v=1/v,r[0]=m*v,r[1]=(-l*o+a*u)*v,r[2]=(c*o-a*h)*v,r[3]=p*v,r[4]=(l*n-a*d)*v,r[5]=(-c*n+a*s)*v,r[6]=E*v,r[7]=(-u*n+o*d)*v,r[8]=(h*n-o*s)*v,e.multiplyScalar(1/v),e}}};e.exports=i},function(e,t){function i(e){THREE.Object3D.apply(this),this.space=e}i.prototype=Object.create(THREE.Object3D.prototype),i.prototype.move=function(e){var t=e.length();e=e.clone().normalize().applyQuaternion(this.quaternion),this.space.move(this,e,t)},e.exports=i},function(e,t){function i(e,t){function i(e){a.mouseSpeedX+=4*(e.movementX||e.mozMovementX||e.webkitMovementX||0)}function r(e){switch(e.keyCode){case 65:a.moveLeft=!0;break;case 68:a.moveRight=!0;break;case 87:a.moveForward=!0;break;case 83:a.moveBackward=!0;break;case 82:a.moveUp=!0;break;case 70:a.moveDown=!0;break;case 81:a.rotateLeft=!0;break;case 69:a.rotateRight=!0}}function n(e){switch(e.keyCode){case 65:a.moveLeft=!1;break;case 68:a.moveRight=!1;break;case 87:a.moveForward=!1;break;case 83:a.moveBackward=!1;break;case 82:a.moveUp=!1;break;case 70:a.moveDown=!1;break;case 81:a.rotateLeft=!1;break;case 69:a.rotateRight=!1}}function o(){document.pointerLockElement===t||document.mozPointerLockElement===t||document.webkitPointerLockElement===t?document.addEventListener("mousemove",i,!1):document.removeEventListener("mousemove",i,!1)}var a=this;this.player=e,this.domElement=t,this.velocity=new THREE.Vector3,this.targetVelocity=new THREE.Vector3,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.rotateLeft=!1,this.rotateRight=!1,this.mouseSpeedX=0,this.mouseSpeedY=0,t.onclick=function(){t.requestPointerLock=t.requestPointerLock||t.mozRequestPointerLock||t.webkitRequestPointerLock,t.requestPointerLock()},document.addEventListener("pointerlockchange",o,!1),document.addEventListener("mozpointerlockchange",o,!1),document.addEventListener("webkitpointerlockchange",o,!1),document.addEventListener("keydown",r,!1),document.addEventListener("keyup",n,!1)}i.prototype={update:function(){var e=new THREE.Vector3(0,0,1),t=new THREE.Quaternion;return function(i){var r=this.player;this.mouseSpeedX-=4*this.mouseSpeedX*i,this.mouseSpeedY-=4*this.mouseSpeedY*i;var n=new THREE.Vector3(this.mouseSpeedX*i,-this.mouseSpeedY*i,100);n.normalize(),t.setFromUnitVectors(e,n),r.quaternion.multiplyQuaternions(r.quaternion,t),this.velocity.set(0,0,0),this.moveForward&&this.velocity.add(new THREE.Vector3(0,0,1)),this.moveBackward&&this.velocity.add(new THREE.Vector3(0,0,-1)),this.moveLeft&&this.velocity.add(new THREE.Vector3(-1,0,0)),this.moveRight&&this.velocity.add(new THREE.Vector3(1,0,0)),this.velocity.lengthSq()>0&&(this.velocity.normalize().multiplyScalar(i),this.player.move(this.velocity))}}()},e.exports=i},function(e,t,i){function r(e,t,i){this._webglRenderer=new THREE.WebGLRenderer,this._webglRenderer.autoClear=!1,this.showDiagram=!0,e.appendChild(this._webglRenderer.domElement),this._container=e,this._space=t,this._sceneRenderer=new n(t,this._getWidth(),this._getHeight()),this._scaledRenderer=new o(this._getWidth(),this._getHeight(),this._getPixelSize()),this._diagramRenderer=new a(t,i),this.resize()}var n=i(7),o=i(6),a=i(1);r.prototype={_getWidth:function(){return this._container.clientWidth},_getHeight:function(){return this._container.clientHeight},_getPixelSize:function(){return parseInt(document.querySelector("[name=resolution]:checked").value)},updatePixelSize:function(){this._scaledRenderer.setPixelSize(this._getPixelSize())},render:function(e){this._webglRenderer.setViewport(0,0,this._getWidth(),this._getHeight()),this._sceneRenderer.render(this._webglRenderer,e,this._scaledRenderer.renderTarget),this._scaledRenderer.render(this._webglRenderer),this.showDiagram&&(this._webglRenderer.setViewport(0,0,this._getWidth()/3,this._getHeight()/3),this._webglRenderer.clearDepth(),this._diagramRenderer.render(this._webglRenderer,e))},resize:function(){var e=this._getWidth(),t=this._getHeight();this._webglRenderer.setSize(e,t),this._sceneRenderer.setSize(e,t),this._scaledRenderer.setSize(e,t),this._diagramRenderer.setRatio(e/t)}},e.exports=r},function(e,t){function i(e,t,i){this._width=e,this._height=t,this._pixelSize=i,this.renderTarget=new THREE.WebGLRenderTarget(Math.floor(e/i),Math.floor(t/i),{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat}),this._camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this._scene=new THREE.Scene;var r=new THREE.BufferGeometry,n=new THREE.BufferAttribute(new Float32Array([-1,-1,-1,1,1,1,-1,-1,1,1,1,-1]),2);r.addAttribute("position",n);var o=new THREE.RawShaderMaterial({uniforms:{tRendered:{type:"t",value:this.renderTarget}},vertexShader:["precision highp float;","attribute vec2 position;","varying vec2 vUv;","void main() {","vUv = position * 0.5 + 0.5;","gl_Position = vec4(position, 0.0, 1.0);","}"].join("\n"),fragmentShader:["precision highp float;","varying vec2 vUv;","uniform sampler2D tRendered;","void main() {","gl_FragColor = texture2D(tRendered, vUv);","}"].join("\n"),side:THREE.DoubleSide}),a=new THREE.Mesh(r,o);this._scene.add(a)}i.prototype={setSize:function(e,t){this._width=e,this._height=t,this.renderTarget.setSize(Math.floor(this._width/this._pixelSize),Math.floor(this._height/this._pixelSize))},setPixelSize:function(e){this._pixelSize=e,this.renderTarget.setSize(Math.floor(this._width/this._pixelSize),Math.floor(this._height/this._pixelSize))},render:function(e){e.render(this._scene,this._camera)}},e.exports=i},function(e,t){function i(e,t,i){function r(e,t){t=t||"jpg";var i=["sky_pos_x","sky_neg_x","sky_pos_y","sky_neg_y","sky_pos_z","sky_neg_z"].map(function(i){return e+i+"."+t}),r=n.load(i);return r.format=THREE.RGBFormat,r}this._aspectFix=new THREE.Matrix4;var n=new THREE.CubeTextureLoader;this._uniforms={uRadiusSquared:{type:"f",value:e.radiusSquared},uThroatLength:{type:"f",value:e.throatLength},uSkybox1:{type:"t",value:r("textures/skybox1/")},uSkybox2:{type:"t",value:r("textures/skybox2/")},uCameraPosition:{type:"v3",value:new THREE.Vector3},uCameraOrientation:{type:"m4",value:new THREE.Matrix4}},this._camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this._scene=new THREE.Scene;var o=new THREE.BufferGeometry,a=new THREE.BufferAttribute(new Float32Array([-1,-1,-1,1,1,1,-1,-1,1,1,1,-1]),2);o.addAttribute("position",a);var s=new THREE.RawShaderMaterial({uniforms:this._uniforms,vertexShader:document.getElementById("vertexShader").textContent,fragmentShader:document.getElementById("fragmentShader").textContent,side:THREE.DoubleSide}),h=new THREE.Mesh(o,s);this._scene.add(h)}i.prototype={render:function(e,t,i){this._uniforms.uCameraPosition.value.copy(t.position),this._uniforms.uCameraOrientation.value.makeRotationFromQuaternion(t.quaternion),this._uniforms.uCameraOrientation.value.multiply(this._aspectFix),e.render(this._scene,this._camera,i)},setSize:function(e,t){this._renderWidth=e,this._renderHeight=t;var i,r;e>t?(i=e/t,r=1):(i=1,r=t/e),this._aspectFix.set(i,0,0,0,0,r,0,0,0,0,2,0,0,0,0,1)}},e.exports=i},function(e,t){function i(e){function t(){e.resize()}function i(t){o.blur(),o.checked?(document.body.classList.add("no-ui"),e.showDiagram=!1):(document.body.classList.remove("no-ui"),e.showDiagram=!0)}function r(e){e.target.href||(document.querySelector("#introduction").classList.add("hidden"),t(),document.removeEventListener("click",r,!1))}function n(t){e.updatePixelSize(),t.target.blur()}var o=document.querySelector("[name=hide-ui]");i(),o.addEventListener("change",i,!1),window.addEventListener("resize",t,!1),document.addEventListener("click",r,!1),document.querySelector(".renderer-settings").addEventListener("change",n,!1)}e.exports=i},function(e,t,i){function r(e,t){this.radius=e,this.radiusSquared=e*e,this.throatLength=t}var n=i(2);r.prototype={adjustCartesianDirection:function(e,t){var i=Math.max(0,Math.abs(e.x)-this.throatLength),r=Math.sqrt(i*i+this.radiusSquared);t.y/=r,t.z/=r*Math.sin(e.y)},adjustSphericalDirection:function(e,t){var i=Math.max(0,Math.abs(e.x)-this.throatLength),r=Math.sqrt(i*i+this.radiusSquared);t.y*=r,t.z*=r*Math.sin(e.y)},step:function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3,r=new THREE.Vector3,o=new THREE.Matrix3,a=new THREE.Matrix3,s=new THREE.Vector3,h=new THREE.Matrix3,c=new THREE.Matrix3,d=new THREE.Matrix3,u=new THREE.Vector3,l=new THREE.Vector3,m=new THREE.Matrix3,p=new THREE.Matrix3;return function(E,v,_){var g=E.position,y=Math.max(0,Math.abs(g.x)-this.throatLength),R=this.radiusSquared,w=g.x/Math.abs(g.x)*y,f=g.y,x=v.x,T=v.y,M=v.z,H=w*w,S=T*T,b=M*M,k=Math.sin(f),z=Math.cos(f),L=Math.sin(2*f),V=Math.cos(2*f),q=k*k,P=z*k,C=1/Math.tan(f),D=1/k,F=R,j=1/(F+w*w),B=j*j;if(r.set(w*(S+q*b),-2*w*x*T*j+P*b,-2*w*x*M*j-2*C*T*M),o.set(0,2*T*w,2*M*w*q,-2*T*w*j,-2*x*w*j,M*L,-2*M*w*j,-2*M*C,-2*x*w*j-2*T*C),a.set(S+b*q,b*w*L,0,2*x*T*(H-F)*B,b*V,0,2*x*M*(H-F)*B,2*T*M*D*D,0),m.identity(),n.Matrix3.subtract(m,o.multiplyScalar(_)),n.Matrix3.subtract(m,a.multiplyScalar(_*_)),n.Matrix3.getInverse(p,m),t.copy(r).addScaledVector(v.clone().applyMatrix3(a),_).multiplyScalar(_),t.applyMatrix3(p),e.copy(v.clone().add(t).multiplyScalar(_)),E.__tetrad)for(var U=0;2>U;U++){var W=E.__tetrad[U],X=W.x,G=W.y,O=W.z;s.set(w*(T*G+q*M*O),-w*(x*G+X*T)*j+P*M*O,-w*(x*O+X*M)*j-C*(T*O+G*M)),h.set(0,w*G,w*O*q,-w*G*j,-w*X*j,O*P,-w*O*j,-O*C,-w*X*j-G*C),c.set(T*G+M*O*q,M*w*O*L,0,(T*X+x*G)*(H-F)*B,M*O*V,0,(M*X+x*O)*(H-F)*B,(M*G+T*O)*D*D,0),d.set(0,T*w,M*w*q,-T*w*j,-x*w*j,M*P,-M*w*j,-M*C,-x*w*j-T*C),m.identity(),n.Matrix3.subtract(m,d.multiplyScalar(_)),n.Matrix3.getInverse(p,m),u.copy(e).applyMatrix3(c),l.copy(t).applyMatrix3(h),i.copy(s).add(u).add(l).multiplyScalar(_).applyMatrix3(p),W.add(i)}v.add(t),g.add(e)}}(),quaternionToTetrad:function(){var e=new THREE.Matrix4;return function(t,i){e.makeRotationFromQuaternion(t),i[0].set(e.elements[0],e.elements[1],e.elements[2]),i[1].set(e.elements[4],e.elements[5],e.elements[6])}}(),tetradToQuaternion:function(){var e=new THREE.Matrix4;return function(t,i){t[2].crossVectors(t[0],t[1]);for(var r=0;3>r;r++)t[r].normalize();e.elements[0]=t[0].x,e.elements[1]=t[0].y,e.elements[2]=t[0].z,e.elements[4]=t[1].x,e.elements[5]=t[1].y,e.elements[6]=t[1].z,e.elements[8]=t[2].x,e.elements[9]=t[2].y,e.elements[10]=t[2].z,i.setFromRotationMatrix(e).normalize()}}(),move:function(e,t,i){this.adjustCartesianDirection(e.position,t),e.quaternion&&(e.__tetrad||(e.__tetrad=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]),this.quaternionToTetrad(e.quaternion,e.__tetrad),this.adjustCartesianDirection(e.position,e.__tetrad[0]),this.adjustCartesianDirection(e.position,e.__tetrad[1])),this.step(e,t,i),this.adjustSphericalDirection(e.position,t),e.quaternion&&(this.adjustSphericalDirection(e.position,e.__tetrad[0]),this.adjustSphericalDirection(e.position,e.__tetrad[1]),this.tetradToQuaternion(e.__tetrad,e.quaternion))}},e.exports=r}]);